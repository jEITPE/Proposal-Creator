{% extends 'base.html' %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Poppins', 'Segoe UI', sans-serif;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
    }
    
    /* Estilos para a funcionalidade Sortable */
    .sortable-ghost {
        opacity: 0.5;
        background-color: #f8d7d7 !important;
        border: 2px dashed #e60000 !important;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.2) !important;
    }
    
    .sortable-chosen {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
        transform: translateY(-5px) !important;
        z-index: 10;
    }
    
    .sortable-drag {
        opacity: 0.8;
        transform: rotate(2deg) !important;
    }
    
    .sortable-item {
        transition: all 0.3s ease !important;
    }
    
    .sortable-item:hover {
        background-color: #ffe8e8 !important;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(230, 0, 0, 0.1) !important;
    }
    
    .sortable-container {
        padding: 10px;
        position: relative;
    }
    
    .drop-zone.active {
        display: block !important;
        background-color: rgba(230, 0, 0, 0.1);
        border: 2px dashed #e60000;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% { background-color: rgba(230, 0, 0, 0.05); }
        50% { background-color: rgba(230, 0, 0, 0.15); }
        100% { background-color: rgba(230, 0, 0, 0.05); }
    }
    
    .container-white {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        padding: 35px;
        margin-bottom: 30px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    /* Estilos para cabeçalhos e títulos */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 35px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f2f5;
    }
    
    .section-title {
        font-size: 28px;
        color: #2c3e50;
        margin: 0;
        font-weight: 600;
        position: relative;
    }
    
    .section-title:after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, #e60000, #b40000);
        border-radius: 2px;
    }
    
    /* Estilos para botões */
    .btn-container {
        display: flex;
        gap: 12px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #e60000, #b40000);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(230, 0, 0, 0.2);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #b40000, #e60000);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(230, 0, 0, 0.3);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(127, 140, 141, 0.2);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .btn-secondary:hover {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(127, 140, 141, 0.3);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(46, 204, 113, 0.2);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(46, 204, 113, 0.3);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(231, 76, 60, 0.2);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #c0392b, #e74c3c);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3);
    }
    
    .btn-info {
        background: linear-gradient(135deg, #e60000, #b40000);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(230, 0, 0, 0.2);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .btn-info:hover {
        background: linear-gradient(135deg, #b40000, #e60000);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(230, 0, 0, 0.3);
    }
    
    /* Estilos para formulários */
    .form-group {
        margin-bottom: 30px;
    }
    
    .form-label {
        display: block;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #2c3e50;
    }
    
    .form-control {
        width: 100%;
        padding: 14px 18px;
        border: 1px solid #e0e6ed;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
        background-color: #f9fafc;
        color: #2c3e50;
    }
    
    .form-control:focus {
        border-color: #e60000;
        outline: none;
        box-shadow: 0 0 0 3px rgba(230, 0, 0, 0.2);
        background-color: #fff;
    }
    
    .form-text {
        font-size: 14px;
        color: #7f8c8d;
        margin-top: 8px;
    }
    
    /* Estilos para upload de logo */
    .logo-options {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .logo-option {
        flex: 1;
        background-color: #f9fafc;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid #e0e6ed;
    }
    
    .logo-option-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 16px;
    }
    
    .file-input-container {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .file-input-button {
        background: linear-gradient(135deg, #e60000, #b40000);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 15px;
        font-weight: 500;
        box-shadow: 0 4px 10px rgba(230, 0, 0, 0.2);
    }
    
    .file-input-button:hover {
        background: linear-gradient(135deg, #b40000, #e60000);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(230, 0, 0, 0.3);
    }
    
    .file-input-button input[type="file"] {
        display: none;
    }
    
    .file-name {
        color: #7f8c8d;
        font-size: 14px;
    }
    
    /* Estilos para alertas */
    .alert {
        padding: 18px 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        font-size: 15px;
        display: flex;
        align-items: center;
        border-left: 4px solid;
    }
    
    .alert-info {
        background-color: #ffecec;
        color: #e60000;
        border-color: #e60000;
    }
    
    /* Estilos para as abas de ofertas */
    .ofertas-section {
        margin-bottom: 30px;
    }
    
    /* Estilos para as tabs de ofertas */
    .ofertas-tabs {
        display: flex;
        margin-bottom: 25px;
        overflow-x: auto;
        padding-bottom: 10px;
        justify-content: center;
        gap: 15px;
        scrollbar-width: thin;
        scrollbar-color: #bdc3c7 #f5f7fa;
    }
    
    .ofertas-tabs::-webkit-scrollbar {
        height: 6px;
    }
    
    .ofertas-tabs::-webkit-scrollbar-track {
        background: #f5f7fa;
        border-radius: 10px;
    }
    
    .ofertas-tabs::-webkit-scrollbar-thumb {
        background-color: #bdc3c7;
        border-radius: 10px;
    }
    
    .oferta-tab {
        padding: 12px 24px;
        background-color: #f0f2f5;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 2px solid transparent;
        position: relative;
        min-width: 120px;
        text-align: center;
    }
    
    .oferta-tab:hover {
        background-color: #e1e6ed;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* Melhorar destaque visual para múltiplas tabs selecionadas */
    .oferta-tab.active {
        background: linear-gradient(135deg, #e60000, #b40000);
        color: white;
        box-shadow: 0 4px 10px rgba(230, 0, 0, 0.3);
        border: 2px solid #b40000;
        position: relative;
        transform: translateY(-3px);
    }
    
    .oferta-tab.active::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #b40000;
    }
    
    .oferta-content {
        display: none;
        animation: fadeIn 0.5s ease;
        transition: opacity 0.3s ease;
        opacity: 0;
        background-color: #fff;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
    }
    
    .oferta-content.active {
        display: block;
        opacity: 1;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .oferta-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e0e6ed;
    }
    
    .oferta-title {
        font-size: 20px;
        color: #2c3e50;
        margin-bottom: 10px;
        font-weight: 600;
    }
    
    .oferta-description {
        color: #7f8c8d;
        font-size: 14px;
    }
    
    /* Estilos para blocos de conteúdo */
    .blocos-category {
        margin-bottom: 30px;
        background-color: #f9fafc;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e0e6ed;
    }
    
    .blocos-category-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e6ed;
    }
    
    .checkbox-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
        .checkbox-item {
        display: flex;
            align-items: flex-start;
        padding: 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 1px solid #f0f2f5;
    }
    
    .checkbox-item:hover {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
    }
    
    .checkbox-item input[type="checkbox"] {
        margin-right: 12px;
        margin-top: 3px;
        width: 18px;
        height: 18px;
        accent-color: #3498db;
    }
    
    .checkbox-item label {
        font-size: 15px;
        color: #2c3e50;
        font-weight: 500;
        display: flex;
            flex-direction: column;
        gap: 8px;
    }
    
    .mandatory-badge {
        background-color: #e60000;
        color: white;
        font-size: 10px;
        padding: 4px 8px;
        border-radius: 4px;
        margin-left: 10px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        letter-spacing: 0.5px;
    }
    
    .btn-editar-bloco {
        background-color: rgba(230, 0, 0, 0.1);
        color: #e60000;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 10px;
        transition: all 0.2s ease;
    }
    
    .btn-editar-bloco:hover {
        background-color: rgba(230, 0, 0, 0.2);
        transform: translateY(-1px);
    }
    
    /* Estilos para blocos selecionados */
    .card {
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        height: 100%;
        border: none;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    }
    
    .card-header.bg-dark {
        background: linear-gradient(135deg, #2c3e50, #34495e) !important;
        color: #ffffff;
        padding: 18px 20px;
        font-weight: 600;
        border: none;
    }
    
    .card-header.bg-primary {
        background: linear-gradient(135deg, #e60000, #b40000) !important;
        color: #ffffff;
        padding: 15px 20px;
        font-weight: 600;
        border: none;
    }
    
    .card-body.bg-light {
        background-color: #f9fafc;
        padding: 25px;
    }
    
    .border-primary {
        border: none !important;
    }
    
    .btn-success.btn-lg {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        border: none;
        padding: 15px 25px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(46, 204, 113, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s ease;
    }
    
    .btn-success.btn-lg:hover {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
    }
    
    .btn-group.w-100 {
        display: flex;
        gap: 10px;
    }
    
    .btn-group.w-100 .btn {
        flex: 1;
        padding: 12px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }
    
    /* Estilos para o modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
    }
    
    .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 30px;
        border: none;
        width: 80%;
        max-width: 900px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f2f5;
        margin-bottom: 25px;
    }
    
    .modal-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }
    
    .close {
        color: #7f8c8d;
        font-size: 30px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }
    
    .close:hover {
        color: #2c3e50;
        background-color: #f0f2f5;
    }
    
    .modal-footer {
        padding-top: 20px;
        border-top: 2px solid #f0f2f5;
        margin-top: 25px;
        display: flex;
        justify-content: flex-end;
        gap: 15px;
    }
    
    /* Estilos responsivos */
    @media (max-width: 768px) {
        .checkbox-item {
            flex: 0 0 100%;
        }
        
        .logo-options {
            flex-direction: column;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 20px;
        }
        
        .section-header .btn-container {
            flex-wrap: wrap;
            width: 100%;
        }
        
        .section-header .btn-container a {
            flex: 1;
            text-align: center;
        }
        
        .submit-container {
            flex-direction: column;
            gap: 15px;
            align-items: stretch;
        }
        
        .submit-container button {
            width: 100%;
        }
        
        .ofertas-tabs {
            flex-direction: column;
            gap: 10px;
        }
    }
    
    /* Estilos para os blocos obrigatórios */
    .blocos-obrigatorios-section {
        margin-top: 30px;
        border-top: 1px solid #e0e6ed;
        padding-top: 30px;
        animation: fadeIn 0.5s ease;
        display: none;
        background-color: #f8f9fb;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #e0e6ed;
    }
    
    .blocos-obrigatorios-section .blocos-category-title {
        font-size: 20px;
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 2px solid #e60000;
        padding-bottom: 10px;
    }
    
    .blocos-obrigatorios-section .blocos-category-title i {
        color: #e60000;
    }
    
    .info-tooltip {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background-color: #ecf0f1;
        color: #7f8c8d;
        font-size: 12px;
        margin-left: 8px;
        cursor: help;
    }
    
    .bloco-obrigatorio {
        background-color: #ffecec;
        border-left: 4px solid #e60000;
        border-radius: 6px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        padding: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    
    .bloco-obrigatorio:hover {
        background-color: #ffe0e0;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(230, 0, 0, 0.1);
    }
    
    .mandatory-badge {
        background-color: #e60000;
        color: white;
        font-size: 10px;
        padding: 4px 8px;
        border-radius: 4px;
        margin-left: 10px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        letter-spacing: 0.5px;
    }
    
    .btn-editar-bloco {
        background-color: rgba(230, 0, 0, 0.1);
        color: #e60000;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 10px;
        transition: all 0.2s ease;
    }
    
    .btn-editar-bloco:hover {
        background-color: rgba(230, 0, 0, 0.2);
        transform: translateY(-1px);
    }

    /* Estilos para os blocos específicos e obrigatórios */
    .blocos-category {
        margin-bottom: 30px;
    }

    .blocos-category-title {
        font-size: 18px;
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 2px solid #e67e22;
        padding-bottom: 10px;
    }

    .blocos-obrigatorios-section .blocos-category-title {
        font-size: 20px;
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 2px solid #e60000;
        padding-bottom: 10px;
    }

    .blocos-obrigatorios-section .blocos-category-title i {
        color: #e60000;
    }

    .checkbox-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .checkbox-item {
        display: flex;
        align-items: flex-start;
        padding: 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 1px solid #f0f2f5;
    }

    .bloco-especifico {
        background-color: #fef5e9;
        border-left: 4px solid #e67e22;
        margin-bottom: 5px;
    }

    .bloco-especifico:hover {
        background-color: #fdebd0;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(230, 126, 34, 0.1);
    }

    .bloco-obrigatorio {
        background-color: #ffecec;
        border-left: 4px solid #e60000;
        border-radius: 8px;
        margin-bottom: 0;
        transition: all 0.3s ease;
        padding: 15px;
    }

    .bloco-obrigatorio:hover {
        background-color: #ffe0e0;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(230, 0, 0, 0.1);
    }

    .checkbox-item input[type="checkbox"] {
        margin-right: 12px;
    }

    .checkbox-item label {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        font-weight: 500;
        color: #2c3e50;
        cursor: pointer;
    }

    /* Estilos adicionais para ofertas */
    .nenhuma-oferta-selecionada {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    .oferta-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e0e6ed;
    }

    .oferta-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .oferta-description {
        color: #7f8c8d;
        font-size: 16px;
    }

    /* Estilos para os blocos em grid */
    .blocos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .bloco-card {
        background-color: #fef9f2;
        border-radius: 8px;
        border: 1px solid #fbe5d0;
        transition: all 0.3s ease;
        overflow: hidden;
        box-shadow: 0 3px 8px rgba(230, 126, 34, 0.08);
    }

    .bloco-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(230, 126, 34, 0.12);
        border-color: #f6c79e;
    }

    .bloco-card-header {
        padding: 15px;
        border-bottom: 1px solid #fbe5d0;
        background-color: #fef5e9;
    }

    .bloco-card-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
        color: #e67e22;
        margin: 0;
        cursor: pointer;
        font-size: 15px;
        width: 100%;
    }

    .bloco-card-title input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #e67e22;
    }

    .bloco-card-actions {
        padding: 12px 15px;
        display: flex;
        justify-content: flex-end;
        background-color: #fff;
    }

    .bloco-card-actions .btn-editar-bloco {
        background-color: #e67e22;
        color: white;
        padding: 8px 15px;
        border-radius: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-weight: 500;
    }

    .bloco-card-actions .btn-editar-bloco:hover {
        background-color: #d35400;
        transform: translateY(-2px);
        box-shadow: 0 3px 8px rgba(230, 126, 34, 0.2);
    }

    .bloco-card.bloco-obrigatorio {
        background-color: #e8f4fc;
        border: 1px solid #c4e5f7;
        border-left: 4px solid #3498db;
        transition: all 0.3s ease;
        margin-bottom: 15px;
        border-radius: 8px;
        overflow: hidden;
    }

    .bloco-card.bloco-obrigatorio .bloco-card-header {
        background-color: #e1f0fa;
        border-bottom: 1px solid #c4e5f7;
        padding: 15px;
    }

    .bloco-card.bloco-obrigatorio .bloco-card-title {
        color: #3498db;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .bloco-card.bloco-obrigatorio .bloco-card-actions {
        background-color: #f8fbfe;
        padding: 12px 15px;
        display: flex;
        justify-content: flex-end;
    }

    .bloco-card.bloco-obrigatorio .btn-editar-bloco {
        background-color: #3498db;
        color: white;
        padding: 8px 15px;
        border-radius: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
        border: none;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .bloco-card.bloco-obrigatorio .btn-editar-bloco:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 3px 8px rgba(52, 152, 219, 0.2);
    }

    .bloco-card.bloco-obrigatorio .mandatory-badge {
        background-color: #3498db;
        color: white;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        margin-left: auto;
        font-weight: normal;
    }

    /* Ajustar o tamanho do checkbox para melhor visualização */
    .bloco-card.bloco-obrigatorio input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #3498db;
    }

    .sem-blocos-especificos {
        display: none !important;
    }

    /* Estilo para destacar múltiplas ofertas selecionadas */
    .ofertas-tabs {
        display: flex;
        margin-bottom: 25px;
        overflow-x: auto;
        padding-bottom: 10px;
        justify-content: center;
        gap: 15px;
        scrollbar-width: thin;
        scrollbar-color: #bdc3c7 #f5f7fa;
    }

    /* Adicionar um contador de ofertas selecionadas */
    .ofertas-contador {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 15px;
        gap: 10px;
        color: #3498db;
        font-weight: 600;
        font-size: 14px;
        padding: 8px 15px;
        background-color: #eaf2f8;
        border-radius: 20px;
        box-shadow: 0 2px 5px rgba(52, 152, 219, 0.1);
    }
</style>

{% if get_flashed_messages() %}
<div class="info-alert">
    <i class="fas fa-info-circle"></i>
    <div>
    {% for message in get_flashed_messages() %}
        {{ message }}
    {% endfor %}
    </div>
</div>
{% endif %}

<div class="container-white">
    <div class="section-header">
        <h2 class="section-title">Criar Nova Proposta</h2>
        <div style="display: flex; gap: 12px;">
            <a href="{{ url_for('exibir_criar_proposta', nova=1) }}" class="btn-primary">
                <i class="fas fa-plus"></i> Nova Proposta
            </a>
            <a href="{{ url_for('dashboard') }}" class="btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
            </a>
        </div>
    </div>

    <form id="propostaForm" action="{{ url_for('criar_proposta') }}" method="post" enctype="multipart/form-data">
        {% if rascunho_id %}
        <input type="hidden" name="rascunho_id" value="{{ rascunho_id }}">
        {% endif %}
        <div class="form-group">
            <label for="nome_cliente" class="form-label">Nome do Cliente</label>
            <input type="text" id="nome_cliente" name="nome_cliente" class="form-control" value="{{ rascunho.nome_cliente or cliente }}" required>
            <small class="form-text">Digite o nome completo do cliente para a proposta.</small>
        </div>

        <div class="form-group">
            <label class="form-label">Logo do Cliente</label>
            
            <div class="logo-options">
                <div class="logo-option" style="background-color: #f9fafc; border-radius: 10px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); border: 1px solid #e0e6ed; transition: all 0.3s ease;">
                    <div class="logo-option-title" style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #2c3e50; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-image" style="color: #e60000;"></i> Upload de Arquivo
                    </div>
                    <div class="file-input-container">
                        <label class="file-input-button">
                            <i class="fas fa-upload"></i> Escolher arquivo
                            <input type="file" id="logo_file" name="logo_file" accept="image/*" onchange="updateFileName(this); previewLogo(this)">
                        </label>
                        <span class="file-name" id="file-name" style="color: #7f8c8d; font-size: 14px;">
                            {% if rascunho.logo_cliente and ('/' in rascunho.logo_cliente or '\\' in rascunho.logo_cliente) %}
                                Arquivo selecionado
                            {% else %}
                                Nenhum arquivo selecionado
                            {% endif %}
                        </span>
                    </div>
                    <small class="form-text" style="color: #7f8c8d; margin-top: 10px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-info-circle"></i> Formatos aceitos: JPG, PNG, GIF (máx. 2MB)
                    </small>
                </div>
            </div>
            
            {% if rascunho.logo_cliente and ('/' in rascunho.logo_cliente or '\\' in rascunho.logo_cliente) %}
            <div style="margin-top: 20px; background-color: #f9fafc; border-radius: 10px; padding: 20px; border: 1px solid #e0e6ed; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);">
                <p style="font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-check-circle" style="color: #2ecc71;"></i> <strong>Logo atual:</strong>
                </p>
                <img src="/{{ rascunho.logo_cliente }}" 
                     alt="Logo do cliente" style="max-height: 100px; max-width: 200px; border: 1px solid #e0e6ed; padding: 10px; border-radius: 8px; background-color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                <input type="hidden" name="logo_atual" value="{{ rascunho.logo_cliente }}">
            </div>
            {% endif %}
        </div>

        <!-- Seção de Ofertas -->
        <div class="ofertas-section">
            <label class="form-label">Selecione a Oferta</label>
            
            <div class="alert alert-info" style="background-color: #ffecec; color: #e60000; border-left: 4px solid #e60000; padding: 18px 20px; border-radius: 8px; margin-bottom: 25px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(230, 0, 0, 0.1); animation: fadeIn 0.5s ease;">
                <i class="fas fa-info-circle" style="font-size: 24px; color: #e60000;"></i>
                <div>
                    <strong style="font-weight: 600; display: block; margin-bottom: 5px;">Dica:</strong>
                    Clique em uma oferta para visualizar seus blocos específicos. Depois, selecione os blocos desejados para incluir na proposta.
                </div>
            </div>
            
            <!-- Adicionar contador de ofertas após as tabs -->
            <div class="ofertas-tabs">
                {% for oferta_nome, oferta_dados in ofertas.items() %}
                <div class="oferta-tab" data-oferta="{{ oferta_nome }}" onclick="selecionarOferta('{{ oferta_nome }}')">
                    {{ oferta_nome }}
                </div>
                {% endfor %}
            </div>
            
            <!-- Contador de ofertas selecionadas (inicialmente oculto) -->
            <div class="ofertas-contador" id="ofertas-contador" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <span id="contador-texto">Nenhuma oferta selecionada</span>
            </div>
            
            <input type="hidden" name="oferta_selecionada" id="oferta_selecionada" value="{{ rascunho.oferta_selecionada }}">
            
            <!-- Mensagem quando nenhuma oferta está selecionada -->
            <div class="nenhuma-oferta-selecionada" style="text-align: center; padding: 50px 20px; background-color: #f8f9fa; border-radius: 10px; margin-top: 20px; border: 1px dashed #ccc;">
                <i class="fas fa-hand-pointer" style="font-size: 48px; color: #7f8c8d; margin-bottom: 20px;"></i>
                <h4 style="color: #34495e; margin-bottom: 15px;">Selecione uma oferta acima</h4>
                <p style="color: #7f8c8d; max-width: 600px; margin: 0 auto;">Clique em uma das ofertas acima para visualizar e selecionar os blocos disponíveis para a sua proposta.</p>
            </div>
            
            {% for oferta_nome, oferta_dados in ofertas.items() %}
            <div class="oferta-content" id="oferta-{{ oferta_nome }}">
                <div class="oferta-header">
                    <h3 class="oferta-title">{{ oferta_nome }}</h3>
                    <p class="oferta-description">Selecione os blocos para esta oferta</p>
                </div>
                
                <!-- Blocos Específicos -->
                <div class="blocos-category">
                    <h4 class="blocos-category-title">
                        <i class="fas fa-cubes"></i> Blocos Específicos
                        <span class="info-tooltip" data-toggle="tooltip" title="Selecione os blocos específicos que deseja incluir na proposta.">
                            <i class="fas fa-info-circle"></i>
                        </span>
                    </h4>
                    <div class="blocos-grid" id="blocos-checkboxes">
                        {% for bloco_nome, bloco_dados in oferta_dados.blocos.items() %}
                        <div class="bloco-card" data-bloco="{{ bloco_nome }}">
                            <div class="bloco-card-header">
                                <label class="bloco-card-title" for="bloco-{{ bloco_nome }}">
                                    <input type="checkbox" id="bloco-{{ bloco_nome }}" name="blocos_selecionados" value="{{ bloco_nome }}"
                                           {% if bloco_nome in rascunho.blocos_selecionados %}checked{% endif %}>
                                    <span>{{ bloco_nome.replace('_', ' ').capitalize() }}</span>
                                </label>
                            </div>
                            <div class="bloco-card-actions">
                                <button type="button" class="btn-editar-bloco" data-bloco="{{ bloco_nome }}">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Seção de Blocos Obrigatórios com estilo melhorado -->
        <div class="blocos-obrigatorios-section" style="margin-bottom: 35px; background-color: #fff; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);">
            <h3 class="blocos-category-title" style="display: flex; align-items: center; font-size: 22px; color: #2c3e50; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #e60000;">
                <i class="fas fa-shield-alt" style="color: #e60000; margin-right: 10px;"></i> 
                Blocos Obrigatórios
                <span class="info-tooltip" title="Estes blocos são necessários em todas as propostas. Arraste para reorganizar." style="margin-left: 10px; cursor: help; font-size: 14px; display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; background-color: rgba(230, 0, 0, 0.1); color: #e60000;">
                    <i class="fas fa-info"></i>
                </span>
            </h3>
            
            {% if not is_admin and not is_superusuario %}
            <div class="alert alert-info" style="background-color: #e3f2fd; color: #0c5460; border-left: 4px solid #0c5460; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-info-circle" style="font-size: 20px;"></i>
                <div>
                    <strong>Informação:</strong> Você está visualizando apenas os blocos para os quais tem permissão. Blocos obrigatórios são incluídos automaticamente.
                </div>
            </div>
            {% endif %}
            
            <div class="alert alert-info" style="background-color: #ffecec; color: #e60000; border-left: 4px solid #e60000; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-info-circle" style="font-size: 20px;"></i>
                <div>
                    <strong>Importante:</strong> Os blocos são obrigatórios, mas você pode reorganizá-los arrastando conforme a hierarquia desejada.
                </div>
            </div>
            
            <!-- Layout de duas colunas -->
            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                <!-- Coluna esquerda: Blocos obrigatórios -->
                <div style="flex: 1; min-width: 300px; max-width: 50%;">
                    <div style="background-color: #fff; border-radius: 8px; border: 1px solid #e0e6ed; padding: 15px; margin-bottom: 20px;">
                        <h4 style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-list" style="color: #e60000;"></i> Blocos Disponíveis
                        </h4>
                        <p style="font-size: 14px; color: #7f8c8d; margin-bottom: 15px;">
                            Arraste os blocos para a direita para definir a ordem na proposta.
                        </p>
                        <div id="blocos-obrigatorios-container" class="sortable-container" style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                            {% set blocos_ja_adicionados = [] %}
                            
                            {% if blocos_por_oferta is defined and blocos_por_oferta.geral is defined %}
                                {% for bloco_nome, bloco in blocos_por_oferta.geral.items() %}
                                    {% if bloco.obrigatorio and bloco_nome not in blocos_ja_adicionados %}
                                        {% set _ = blocos_ja_adicionados.append(bloco_nome) %}
                                        <div class="bloco-obrigatorio sortable-item" data-oferta="geral" data-bloco="{{ bloco_nome }}" style="background-color: #ffecec; border-left: 4px solid #e60000; border-radius: 8px; padding: 15px; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); cursor: grab;">
                                            <div style="display: flex; align-items: center;">
                                                <i class="fas fa-grip-vertical" style="margin-right: 12px; color: #999; cursor: grab;"></i>
                                                <input type="checkbox" id="bloco_{{ bloco_nome }}" name="blocos_selecionados" value="{{ bloco_nome }}" checked style="width: 18px; height: 18px; margin-right: 12px;">
                                                <label for="bloco_{{ bloco_nome }}" style="font-weight: 500; color: #2c3e50;">
                                                    {{ bloco_nome|replace('_', ' ') }}
                                                    <span class="mandatory-badge" style="background-color: #e60000; color: white; font-size: 10px; padding: 4px 8px; border-radius: 4px; margin-left: 8px; font-weight: 600; display: inline-flex; align-items: center;">OBRIGATÓRIO</span>
                                                </label>
                                            </div>
                                            <button type="button" class="btn-editar-bloco" data-bloco="{{ bloco_nome }}" style="background-color: rgba(230, 0, 0, 0.1); color: #e60000; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s ease; display: flex; align-items: center; gap: 5px;">
                                                <i class="fas fa-edit"></i> Editar
                                            </button>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            
                            {% for oferta_nome, oferta_dados in ofertas.items() %}
                                {% if oferta_dados.obrigatorios is defined %}
                                    {% for bloco_nome in oferta_dados.obrigatorios %}
                                        {% if bloco_nome not in blocos_ja_adicionados %}
                                            {% set categoria_oferta = 'oferta_' + oferta_nome %}
                                            {% set bloco_existe = false %}
                                            
                                            {% if blocos_por_oferta is defined and categoria_oferta in blocos_por_oferta and bloco_nome in blocos_por_oferta[categoria_oferta] %}
                                                {% set bloco_existe = true %}
                                            {% endif %}
                                            
                                            {% if bloco_existe or is_admin or is_superusuario %}
                                                {% set _ = blocos_ja_adicionados.append(bloco_nome) %}
                                                <div class="bloco-obrigatorio sortable-item" data-oferta="{{ oferta_nome }}" data-bloco="{{ bloco_nome }}" style="background-color: #ffecec; border-left: 4px solid #e60000; border-radius: 8px; padding: 15px; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); cursor: grab;">
                                                    <div style="display: flex; align-items: center;">
                                                        <i class="fas fa-grip-vertical" style="margin-right: 12px; color: #999; cursor: grab;"></i>
                                                        <input type="checkbox" id="bloco_{{ bloco_nome }}" name="blocos_selecionados" value="{{ bloco_nome }}" checked style="width: 18px; height: 18px; margin-right: 12px;">
                                                        <label for="bloco_{{ bloco_nome }}" style="font-weight: 500; color: #2c3e50;">
                                                            {{ bloco_nome|replace('_', ' ') }}
                                                            <span class="mandatory-badge" style="background-color: #e60000; color: white; font-size: 10px; padding: 4px 8px; border-radius: 4px; margin-left: 8px; font-weight: 600; display: inline-flex; align-items: center;">OBRIGATÓRIO</span>
                                                        </label>
                                                    </div>
                                                    <button type="button" class="btn-editar-bloco" data-bloco="{{ bloco_nome }}" style="background-color: rgba(230, 0, 0, 0.1); color: #e60000; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s ease; display: flex; align-items: center; gap: 5px;">
                                                        <i class="fas fa-edit"></i> Editar
                                                    </button>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Coluna direita: Hierarquia de blocos -->
                <div style="flex: 1; min-width: 300px;">
                    <div style="background-color: #fff; border-radius: 8px; border: 1px solid #e0e6ed; padding: 15px;">
                        <h4 style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-sort" style="color: #e60000;"></i> Hierarquia
                        </h4>
                        <p style="font-size: 14px; color: #7f8c8d; margin-bottom: 15px;">
                            Arraste os blocos para definir a ordem em que aparecerão na proposta.
                        </p>
                        <div id="hierarquia-container" class="sortable-container" style="min-height: 300px; border: 2px dashed #e60000; border-radius: 8px; padding: 15px; background-color: rgba(230, 0, 0, 0.05);">
                            <div class="placeholder" style="text-align: center; color: #e60000; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
                                <i class="fas fa-arrow-left" style="font-size: 24px; margin-bottom: 10px;"></i>
                                <p style="font-weight: 500;">Arraste os blocos para cá para definir a hierarquia</p>
                                <small style="color: #666; margin-top: 10px;">Os blocos serão exibidos na proposta na ordem definida aqui</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <p style="font-size: 13px; color: #7f8c8d; font-style: italic;">
                            <i class="fas fa-info-circle"></i> 
                            Todos os blocos obrigatórios serão incluídos na proposta final, independentemente da ordem.
                        </p>
                    </div>
                </div>
            </div>
            
            <input type="hidden" name="blocos_ordem" id="blocos_ordem" value="">
        </div>

        <!-- Blocos Adicionais -->
        <div class="card mb-4">
            <div class="card-header bg-dark" style="background: linear-gradient(135deg, #2c3e50, #1a1a2e) !important; padding: 20px; border-radius: 8px 8px 0 0;">
                <h5 class="mb-0 text-white" style="font-size: 20px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-layer-group"></i> Blocos Selecionados
                </h5>
            </div>
            <div class="card-body bg-light">
                <div class="row mb-4">
                    <div class="col-12">
                        <button type="button" id="btnNovoBloco" class="btn btn-success btn-lg">
                            <i class="fas fa-plus"></i> 
                            <span>Adicionar Novo Bloco</span>
                        </button>
                    </div>
                </div>
                
                <!-- Blocos Temporários -->
                {% if blocos_temporarios and blocos_temporarios|length > 0 %}
                <div class="blocos-category mt-4">
                    <h4 class="blocos-category-title" style="color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-bottom: 15px;">
                        <i class="fas fa-clock"></i> Blocos Temporários para esta Proposta
                    </h4>
                    <div class="checkbox-container" id="blocos-selecionados-container">
                        {% for bloco_nome, bloco_dados in blocos_temporarios.items() %}
                        <div class="checkbox-item bloco-item" style="background-color: rgba(230, 126, 34, 0.1); border-left: 3px solid #e67e22; padding: 10px; margin-bottom: 10px; border-radius: 5px;" data-bloco="{{ bloco_nome }}">
                            <input type="checkbox" id="bloco-temp-{{ bloco_nome }}" name="blocos_selecionados" value="{{ bloco_nome }}"
                                   {% if bloco_nome in rascunho.blocos_selecionados %}checked{% endif %}>
                            <label for="bloco-temp-{{ bloco_nome }}" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <span>{{ bloco_nome.replace('_', ' ').capitalize() }} <small>(Temporário)</small></span>
                                <button type="button" class="btn-editar-bloco" data-bloco="{{ bloco_nome }}" style="background-color: #e67e22;">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="blocos-category mt-4">
                    <h4 class="blocos-category-title" style="color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-bottom: 15px;">
                        <i class="fas fa-clock"></i> Blocos Temporários para esta Proposta
                    </h4>
                    <div class="checkbox-container" id="blocos-selecionados-container">
                        <!-- Aqui serão adicionados os blocos temporários dinamicamente -->
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="submit-container">
            <div>
                <!-- Botão de salvar como rascunho removido, pois o auto-save já está implementado -->
            </div>
            <div>
                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                    <i class="fas fa-paper-plane"></i> 
                    <span style="font-weight: 600;">Gerar Proposta</span>
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Modal de Edição de Bloco -->
<div id="modalEditarBloco" class="modal">
    <div class="modal-content" style="background-color: #fff; border-radius: 12px; box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: none; padding: 30px; animation: modalFadeIn 0.3s ease;">
        <div class="modal-header" style="border-bottom: 2px solid #f0f2f5; margin-bottom: 25px; padding-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h2 class="modal-title" style="font-size: 24px; font-weight: 600; color: #2c3e50; margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-edit" style="color: #e60000;"></i> Editar Bloco: <span id="modalBlocoTitulo"></span>
            </h2>
            <span class="close" style="color: #7f8c8d; font-size: 30px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Editor Quill -->
            <div id="editor-bloco" style="height: 350px; border-radius: 8px; border: 1px solid #e0e6ed; margin-bottom: 20px;"></div>
            <input type="hidden" id="blocoAtual" value="">
            <input type="hidden" id="blocoConteudo" value="">
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" id="btnCancelarEdicao">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="button" class="btn-primary" id="btnSalvarEdicao">
                <i class="fas fa-save"></i> Salvar Alterações
            </button>
        </div>
    </div>
</div>

<!-- Modal de Novo Bloco -->
<div id="modalNovoBloco" class="modal">
    <div class="modal-content" style="background-color: #fff; border-radius: 12px; box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: none; padding: 30px; animation: modalFadeIn 0.3s ease;">
        <div class="modal-header" style="border-bottom: 2px solid #f0f2f5; margin-bottom: 25px; padding-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h2 class="modal-title" style="font-size: 24px; font-weight: 600; color: #2c3e50; margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-plus-circle" style="color: #2ecc71;"></i> Criar Novo Bloco
            </h2>
            <span class="close" style="color: #7f8c8d; font-size: 30px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group mb-3">
                <label for="nomeNovoBloco" class="form-label" style="font-weight: 600; color: #2c3e50; margin-bottom: 10px; display: block;">Nome do Bloco:</label>
                <input type="text" id="nomeNovoBloco" class="form-control" placeholder="Ex: Descrição do Serviço" style="width: 100%; padding: 14px 18px; border: 1px solid #e0e6ed; border-radius: 8px; font-size: 16px; background-color: #f9fafc;">
            </div>
            
            <div class="form-group mb-3">
                <label class="form-label" style="font-weight: 600; color: #2c3e50; margin-bottom: 10px; display: block;">Tipo de Bloco:</label>
                <div style="display: flex; gap: 20px;">
                    <div style="display: flex; align-items: center;">
                        <input type="radio" id="blocoTemporario" name="tipoBloco" value="temporario" checked style="margin-right: 8px;">
                        <label for="blocoTemporario" style="margin: 0; cursor: pointer;">Temporário (apenas para esta proposta)</label>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <input type="radio" id="blocoPermanente" name="tipoBloco" value="permanente" style="margin-right: 8px;">
                        <label for="blocoPermanente" style="margin: 0; cursor: pointer;">Permanente (para uso futuro)</label>
                    </div>
                </div>
            </div>
            
            <!-- Editor Quill para o conteúdo -->
            <div class="form-group">
                <label for="editor-novo-bloco" class="form-label" style="font-weight: 600; color: #2c3e50; margin-bottom: 10px; display: block;">Conteúdo do Bloco:</label>
                <div id="editor-novo-bloco" style="height: 350px; border-radius: 8px; border: 1px solid #e0e6ed;"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" id="btnCancelarNovo">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="button" class="btn-primary" id="btnSalvarNovo">
                <i class="fas fa-plus"></i> Criar Bloco
            </button>
        </div>
    </div>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<!-- Adicionar SortableJS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
    function updateFileName(input) {
        const fileName = input.files[0] ? input.files[0].name : 'Nenhum arquivo selecionado';
        document.getElementById('file-name').textContent = fileName;
    }

    function previewLogo(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Apenas exibir a imagem selecionada se necessário
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar o editor Quill
        const quill = new Quill('#editor-bloco', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    ['link', 'image'],
                    ['clean']
                ]
            },
            placeholder: 'Edite o conteúdo do bloco aqui...'
        });
        
        // Inicializar o editor Quill para novos blocos
        const quillNovo = new Quill('#editor-novo-bloco', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    ['link', 'image'],
                    ['clean']
                ]
            },
            placeholder: 'Digite o conteúdo do novo bloco aqui...'
        });
        
        // Configurar o modal de edição
        const modal = document.getElementById('modalEditarBloco');
        const modalNovo = document.getElementById('modalNovoBloco');
        const span = modal.getElementsByClassName('close')[0];
        const spanNovo = modalNovo.getElementsByClassName('close')[0];
        const btnCancelar = document.getElementById('btnCancelarEdicao');
        const btnCancelarNovo = document.getElementById('btnCancelarNovo');
        const btnSalvar = document.getElementById('btnSalvarEdicao');
        const btnSalvarNovo = document.getElementById('btnSalvarNovo');
        
        span.onclick = function() {
            modal.style.display = 'none';
        }
        
        btnCancelar.onclick = function() {
            modal.style.display = 'none';
        }
        
        // Configurar botões de fechamento do modal novo bloco
        spanNovo.onclick = function() {
            modalNovo.style.display = 'none';
        }
        
        btnCancelarNovo.onclick = function() {
            modalNovo.style.display = 'none';
        }
        
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
            if (event.target == modalNovo) {
                modalNovo.style.display = 'none';
            }
        }
        
        // Configurar o botão de salvar edição
        btnSalvar.onclick = function() {
            const blocoNome = document.getElementById('blocoAtual').value;
            const conteudo = quill.root.innerHTML;
            
            console.log('Salvando bloco:', blocoNome);
            
            // Desabilitar o botão durante o salvamento
            btnSalvar.disabled = true;
            btnSalvar.textContent = 'Salvando...';
            
            // Salvar o conteúdo editado
            fetch('/api/salvar_bloco', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    nome: blocoNome,
                    texto: conteudo
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Resposta do servidor:', data);
                
                if (data.success) {
                    alert('Bloco salvo com sucesso!');
                    modal.style.display = 'none';
                } else {
                    alert('Erro ao salvar o bloco: ' + (data.error || 'Erro desconhecido'));
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao salvar o bloco: ' + error.message);
            })
            .finally(() => {
                // Reabilitar o botão após o salvamento
                btnSalvar.disabled = false;
                btnSalvar.textContent = 'Salvar Alterações';
            });
        };
        
        // Configurar o botão de salvar novo bloco
        btnSalvarNovo.onclick = function() {
            const blocoNome = document.getElementById('nomeNovoBloco').value.trim().replace(/\s+/g, '_');
            const conteudo = quillNovo.root.innerHTML;
            const cliente = document.getElementById('nome_cliente').value;
            const temporario = document.getElementById('blocoTemporario').checked;
            
            // Verificar se o elemento rascunho_id existe
            let rascunhoId = '';
            const rascunhoIdElement = document.getElementById('rascunho_id');
            if (rascunhoIdElement) {
                rascunhoId = rascunhoIdElement.value;
            }
            
            if (!blocoNome) {
                alert('Por favor, informe um nome para o bloco.');
                return;
            }
            
            console.log('Criando novo bloco:', blocoNome, temporario ? '(temporário)' : '(permanente)');
            
            // Desabilitar o botão durante o salvamento
            btnSalvarNovo.disabled = true;
            btnSalvarNovo.textContent = 'Salvando...';
            
            // Salvar o novo bloco
            fetch('/api/salvar_bloco', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    nome: blocoNome,
                    texto: conteudo,
                    cliente: cliente,
                    rascunho_id: rascunhoId,
                    temporario: temporario
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Resposta do servidor:', data);
                
                if (data.success) {
                    alert('Bloco criado com sucesso!');
                    modalNovo.style.display = 'none';
                    
                    // Em vez de recarregar a página, adicionar o bloco à lista de blocos selecionados
                    const blocoNome = document.getElementById('nomeNovoBloco').value.trim().replace(/\s+/g, '_');
                    const temporario = document.getElementById('blocoTemporario').checked;
                    
                    // Adicionar o bloco à lista de blocos selecionados
                    const blocosContainer = document.getElementById('blocos-selecionados-container');
                    if (blocosContainer) {
                        // Criar elemento para o novo bloco
                        const novoBloco = document.createElement('div');
                        novoBloco.className = 'bloco-item';
                        novoBloco.setAttribute('data-bloco', blocoNome);
                        
                        // Determinar o tipo de bloco (temporário ou permanente)
                        const tipoBloco = temporario ? 'temporario' : 'permanente';
                        
                        // Adicionar HTML para o novo bloco
                        novoBloco.innerHTML = `
                            <div class="bloco-header">
                                <div class="bloco-title">
                                    <span class="bloco-badge ${tipoBloco}">${temporario ? 'Temporário' : 'Permanente'}</span>
                                    <span class="bloco-name">${blocoNome.replace(/_/g, ' ')}</span>
                                </div>
                                <div class="bloco-actions">
                                    <button type="button" class="btn-edit" onclick="editarBloco('${blocoNome}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn-delete" onclick="excluirBloco('${blocoNome}')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        // Adicionar o novo bloco ao container
                        blocosContainer.appendChild(novoBloco);
                        
                        // Adicionar o bloco à lista de blocos selecionados (checkbox)
                        const checkboxesContainer = document.getElementById('blocos-checkboxes');
                        if (checkboxesContainer) {
                            const checkboxItem = document.createElement('div');
                            checkboxItem.className = 'checkbox-item';
                            checkboxItem.innerHTML = `
                                <input type="checkbox" id="bloco_${blocoNome}" name="blocos" value="${blocoNome}" checked>
                                <label for="bloco_${blocoNome}">${blocoNome.replace(/_/g, ' ')}</label>
                            `;
                            checkboxesContainer.appendChild(checkboxItem);
                        }
                    }
                } else {
                    alert('Erro ao criar o bloco: ' + (data.error || 'Erro desconhecido'));
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao criar o bloco: ' + error.message);
            })
            .finally(() => {
                // Reabilitar o botão após o salvamento
                btnSalvarNovo.disabled = false;
                btnSalvarNovo.textContent = 'Criar Bloco';
            });
        };
        
        // Configurar os botões de edição inicialmente
        configurarBotoesEdicao();
    });
    
    // Função para editar um bloco
    function editarBloco(blocoNome) {
        const modal = document.getElementById('modalEditarBloco');
        const modalTitulo = document.getElementById('modalBlocoTitulo');
        const blocoAtual = document.getElementById('blocoAtual');
        
        console.log('Editando bloco:', blocoNome);
        
        // Definir o título do modal e o bloco atual
        modalTitulo.textContent = blocoNome.replace(/_/g, ' ').capitalize();
        blocoAtual.value = blocoNome;
        
        // Exibir o modal antes de carregar o conteúdo
        modal.style.display = 'block';
        
        // Inicializar o editor com conteúdo vazio
        const quill = Quill.find(document.getElementById('editor-bloco'));
        quill.root.innerHTML = '<p>Carregando conteúdo...</p>';
        
        // Carregar o conteúdo do bloco
        fetch(`/api/bloco/${blocoNome}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Dados do bloco recebidos:', data);
                
                // Inicializar o editor com o conteúdo do bloco
                quill.root.innerHTML = data.texto || '';
            })
            .catch(error => {
                console.error('Erro ao carregar o bloco:', error);
                quill.root.innerHTML = '<p>Erro ao carregar o conteúdo do bloco. Você pode editar mesmo assim e o bloco será criado.</p>';
            });
    }
    
    // Função para configurar os botões de edição
    function configurarBotoesEdicao() {
        document.querySelectorAll('.btn-editar-bloco').forEach(btn => {
            btn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                const blocoNome = this.getAttribute('data-bloco');
                editarBloco(blocoNome);
            };
        });
    }
    
    // Função para selecionar uma oferta
    function selecionarOferta(ofertaNome) {
        // Verificar se a oferta já está selecionada
        const ofertaTab = document.querySelector(`.oferta-tab[data-oferta="${ofertaNome}"]`);
        const jaEstaSelecionada = ofertaTab.classList.contains('active');
        
        // Se a oferta já está selecionada, vamos removê-la da seleção
        if (jaEstaSelecionada) {
            // Remove a classe active da tab
            ofertaTab.classList.remove('active');
            
            // Esconde os blocos específicos desta oferta
            const ofertaContent = document.getElementById(`oferta-${ofertaNome}`);
            ofertaContent.style.display = 'none';
            ofertaContent.classList.remove('active');
            
            // Atualizar o campo hidden com as ofertas restantes
            let ofertasSelecionadas = [];
            document.querySelectorAll('.oferta-tab.active').forEach(tab => {
                ofertasSelecionadas.push(tab.getAttribute('data-oferta'));
            });
            document.getElementById('oferta_selecionada').value = ofertasSelecionadas.join(',');
            
            // Se não houver mais ofertas selecionadas, mostrar a mensagem inicial
            if (ofertasSelecionadas.length === 0) {
                document.querySelector('.nenhuma-oferta-selecionada').style.display = 'block';
            }
            
            // Atualizar a exibição dos blocos obrigatórios
            atualizarBlocosObrigatorios();
            
            // Atualizar o contador de ofertas
            atualizarContadorOfertas();
            return;
        }
        
        // Esconder a mensagem de nenhuma oferta selecionada
        document.querySelector('.nenhuma-oferta-selecionada').style.display = 'none';
        
        // Adicionar classe active na tab selecionada (sem remover das outras)
        ofertaTab.classList.add('active');
        
        // Mostrar os blocos específicos da oferta selecionada
        const ofertaContent = document.getElementById(`oferta-${ofertaNome}`);
        ofertaContent.style.display = 'block';
        ofertaContent.classList.add('active');
        
        // Aplicar animação de fade in
        ofertaContent.style.opacity = '0';
        setTimeout(() => {
            ofertaContent.style.opacity = '1';
        }, 50);
        
        // Atualizar o campo hidden com todas as ofertas selecionadas
        let ofertasSelecionadas = [];
        document.querySelectorAll('.oferta-tab.active').forEach(tab => {
            ofertasSelecionadas.push(tab.getAttribute('data-oferta'));
        });
        document.getElementById('oferta_selecionada').value = ofertasSelecionadas.join(',');
        
        // Atualizar a exibição dos blocos obrigatórios
        atualizarBlocosObrigatorios();
        
        // Inicializar tooltips (verificar se jQuery está disponível)
        if (typeof jQuery !== 'undefined' && typeof jQuery().tooltip === 'function') {
            jQuery('[data-toggle="tooltip"]').tooltip();
        }
        
        // Atualizar o contador de ofertas selecionadas
        atualizarContadorOfertas();
    }
    
    // Adicionar método capitalize ao protótipo de String
    String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    };

    // Adicionar esta função no script do template criar_proposta.html
    function excluirBloco(blocoNome) {
        if (confirm(`Tem certeza que deseja excluir o bloco "${blocoNome}"?`)) {
            fetch(`/api/excluir_bloco/${blocoNome}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Bloco excluído com sucesso!');
                    
                    // Em vez de recarregar a página, remover o bloco da lista
                    const blocoElement = document.querySelector(`.bloco-item[data-bloco="${blocoNome}"]`);
                    if (blocoElement) {
                        blocoElement.remove();
                    }
                    
                    // Remover também o checkbox correspondente
                    const checkboxElement = document.querySelector(`input[name="blocos"][value="${blocoNome}"]`);
                    if (checkboxElement && checkboxElement.parentElement) {
                        checkboxElement.parentElement.remove();
                    }
                } else {
                    alert('Erro ao excluir o bloco: ' + (data.error || 'Erro desconhecido'));
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao excluir o bloco: ' + error.message);
            });
        }
    }

    // Função para criar um novo bloco
    function novoBloco() {
        // Verificar se há um cliente selecionado
        const cliente = document.getElementById('nome_cliente').value;
        
        if (!cliente) {
            alert('Por favor, informe o nome do cliente antes de adicionar um bloco.');
            return;
        }
        
        // Limpar o formulário do modal
        document.getElementById('nomeNovoBloco').value = '';
        const quillNovo = Quill.find(document.getElementById('editor-novo-bloco'));
        quillNovo.root.innerHTML = '';
        
        // Abrir o modal de novo bloco
        document.getElementById('modalNovoBloco').style.display = 'block';
    }

    // Inicialização: não carregar nenhuma oferta por padrão
    document.addEventListener('DOMContentLoaded', function() {
        // Esconder todas as ofertas inicialmente
        document.querySelectorAll('.oferta-content').forEach(content => {
            content.classList.remove('active');
            content.style.display = 'none';
        });
        
        // Mostrar a seção de blocos obrigatórios sempre
        document.querySelector('.blocos-obrigatorios-section').style.display = 'block';
        
        // Tornar visíveis todos os blocos obrigatórios
        document.querySelectorAll('.bloco-obrigatorio').forEach(bloco => {
            bloco.style.display = 'flex';
        });
        
        // Mostrar a mensagem de nenhuma oferta selecionada
        document.querySelector('.nenhuma-oferta-selecionada').style.display = 'block';
        
        // Se houver ofertas já selecionadas no rascunho, selecionar automaticamente
        const ofertaSelecionada = document.getElementById('oferta_selecionada').value;
        if (ofertaSelecionada) {
            const ofertas = ofertaSelecionada.split(',');
            ofertas.forEach(oferta => {
                if (oferta.trim()) {
                    // Precisamos usar um setTimeout para garantir que uma oferta seja processada 
                    // completamente antes da próxima, para evitar sobreposições na UI
                    setTimeout(() => {
                        selecionarOferta(oferta.trim());
                    }, 10);
                }
            });
        }
        
        // Inicializar tooltips
        if (typeof jQuery !== 'undefined' && typeof jQuery().tooltip === 'function') {
            jQuery('[data-toggle="tooltip"]').tooltip();
        }
        
        // Inicializar o contador de ofertas
        atualizarContadorOfertas();
        
        // Inicializar Sortable para blocos obrigatórios
        inicializarSortable();
    });

    // Inicializar funcionalidade de arrastar e soltar
    function inicializarSortable() {
        const blocosContainer = document.getElementById('blocos-obrigatorios-container');
        const hierarquiaContainer = document.getElementById('hierarquia-container');
        
        if (blocosContainer && hierarquiaContainer) {
            // Inicializar o container de blocos disponíveis
            const sortableBlocos = new Sortable(blocosContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                handle: '.fa-grip-vertical', // Usar o ícone como alça de arrasto
                group: 'blocos-obrigatorios', // Conectar os grupos
                sort: true,
                onEnd: function(evt) {
                    atualizarOrdemBlocos();
                }
            });
            
            // Inicializar o container de hierarquia
            const sortableHierarquia = new Sortable(hierarquiaContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                handle: '.fa-grip-vertical', // Usar o ícone como alça de arrasto
                group: 'blocos-obrigatorios', // Conectar os grupos
                sort: true,
                onAdd: function(evt) {
                    // Quando um novo item for adicionado, remover o placeholder se houver
                    const placeholder = hierarquiaContainer.querySelector('.placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                    
                    // Efeito visual para mostrar que um item foi adicionado
                    const item = evt.item;
                    item.style.backgroundColor = '#ffd3d3';
                    setTimeout(() => {
                        item.style.backgroundColor = '#ffecec';
                    }, 300);
                    
                    atualizarOrdemBlocos();
                },
                onEnd: function(evt) {
                    atualizarOrdemBlocos();
                    
                    // Se não houver mais itens na hierarquia, mostrar o placeholder
                    if (hierarquiaContainer.children.length === 1 && hierarquiaContainer.querySelector('.placeholder')) {
                        hierarquiaContainer.querySelector('.placeholder').style.display = 'flex';
                    }
                }
            });
            
            // Inicializar a ordem dos blocos
            atualizarOrdemBlocos();
        }
    }
    
    // Atualizar a ordem dos blocos no campo hidden
    function atualizarOrdemBlocos() {
        const hierarquiaContainer = document.getElementById('hierarquia-container');
        if (hierarquiaContainer) {
            const blocos = hierarquiaContainer.querySelectorAll('.bloco-obrigatorio');
            const ordem = Array.from(blocos).map(bloco => bloco.getAttribute('data-bloco'));
            document.getElementById('blocos_ordem').value = JSON.stringify(ordem);
            console.log('Ordem atualizada:', ordem);
        }
    }

    // Atualizar o contador de ofertas selecionadas
    function atualizarContadorOfertas() {
        const ofertasSelecionadas = document.querySelectorAll('.oferta-tab.active');
        const contador = document.getElementById('ofertas-contador');
        const contadorTexto = document.getElementById('contador-texto');
        
        if (ofertasSelecionadas.length > 0) {
            contador.style.display = 'flex';
            
            if (ofertasSelecionadas.length === 1) {
                contadorTexto.textContent = '1 oferta selecionada';
            } else {
                contadorTexto.textContent = `${ofertasSelecionadas.length} ofertas selecionadas`;
            }
        } else {
            contador.style.display = 'none';
        }
    }

    // Função para atualizar a exibição dos blocos obrigatórios
    function atualizarBlocosObrigatorios() {
        // Verificar quais ofertas estão selecionadas
        const ofertasSelecionadas = Array.from(document.querySelectorAll('.oferta-tab.active')).map(tab => 
            tab.getAttribute('data-oferta')
        );
        
        // Se não houver ofertas selecionadas, esconder todos os blocos obrigatórios
        if (ofertasSelecionadas.length === 0) {
            document.querySelector('.blocos-obrigatorios-section').style.display = 'none';
            document.querySelectorAll('.bloco-obrigatorio').forEach(bloco => {
                bloco.style.display = 'none';
            });
            return;
        }
        
        // Mostrar a seção de blocos obrigatórios
        document.querySelector('.blocos-obrigatorios-section').style.display = 'block';
        
        // Mostrar todos os blocos obrigatórios quando qualquer oferta está selecionada
        document.querySelectorAll('.bloco-obrigatorio').forEach(bloco => {
            // Aplicar display flex para todos os blocos obrigatórios
                if (bloco.style.display !== 'flex') {
                    bloco.style.display = 'flex';
                    // Aplicar animação suave
                    bloco.style.opacity = '0';
                    setTimeout(() => {
                        bloco.style.opacity = '1';
                    }, 50);
                }
        });
    }
</script>
{% endblock %} 
